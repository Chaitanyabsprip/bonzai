// Copyright 2022 Robert S. Muhlestein.
// SPDX-License-Identifier: Apache-2.0

package internal_test

import (
	"fmt"
	"os"

	bonzai "github.com/rwxrob/bonzai/pkg"
	"github.com/rwxrob/bonzai/pkg/internal"
	"github.com/rwxrob/bonzai/pkg/to"
)

func ExampleArgsFrom() {
	fmt.Printf("%q\n", bonzai.ArgsFrom(`greet  hi french`))
	fmt.Printf("%q\n", bonzai.ArgsFrom(`greet hi   french `))
	// Output:
	// ["greet" "hi" "french"]
	// ["greet" "hi" "french" ""]
}

func ExampleArgsOrIn_read_Nil() {

	orig := os.Stdin
	defer func() { os.Stdin = orig }()
	os.Stdin, _ = os.Open(`testdata/in`)

	fmt.Println(bonzai.ArgsOrIn(nil))

	// Output:
	// some thing
	// input
	//
	// with blank line
}

func ExampleArgsOrIn_read_Zero_Args() {

	orig := os.Stdin
	defer func() { os.Stdin = orig }()
	os.Stdin, _ = os.Open(`testdata/in`)

	fmt.Println(internal.ArgsOrIn([]string{}))

	// Output:
	// some thing
	// input
	//
	// with blank line
}

func ExampleArgsOrIn_args_Joined() {

	fmt.Println(internal.ArgsOrIn([]string{"some", "thing"}))

	// Output:
	// some thing
}

func ExampleEsc() {
	fmt.Println(to.Esc("|&;()<>![]"))
	fmt.Printf("%q", to.Esc(" \n\r"))
	// Output:
	// \|\&\;\(\)\<\>\!\[\]
	// "\\ \\\n\\\r"
}

func ExampleEscAll() {
	list := []string{"so!me", "<here>", "other&"}
	fmt.Println(to.EscAll(list))
	// Output:
	// [so\!me \<here\> other\&]
}

func ExampleInferredUsage_optional_Param() {
	x := &bonzai.Cmd{
		Params: []string{"p1", "p2"},
		Call:   func(_ *bonzai.Cmd, _ ...string) error { return nil },
	}
	fmt.Println(internal.InferredUsage(x))
	// Output:
	// (p1|p2)?
}

func ExampleInferredUsage_min_One_Param() {
	x := &bonzai.Cmd{
		Params:  []string{"p1", "p2"},
		MinParm: 1,
		Call:    func(_ *bonzai.Cmd, _ ...string) error { return nil },
	}
	fmt.Println(internal.InferredUsage(x))
	// Output:
	// (p1|p2)+
}

func ExampleInferredUsage_min_3_Param() {
	x := &bonzai.Cmd{
		Params:  []string{"p1", "p2"},
		MinParm: 3,
		Call:    func(_ *bonzai.Cmd, _ ...string) error { return nil },
	}
	fmt.Println(internal.InferredUsage(x))
	// Output:
	// (p1|p2){3,}
}

func ExampleInferredUsage_commands() {
	x := &bonzai.Cmd{
		Commands: []*bonzai.Cmd{
			&bonzai.Cmd{Name: "foo", Aliases: []string{"f"}},
			&bonzai.Cmd{Name: "bar"},
		},
	}
	fmt.Println(internal.InferredUsage(x))
	// Output:
	// ((f|foo)|bar)
}

func ExampleInferredUsage_commands_and_Params() {
	x := &bonzai.Cmd{
		Params: []string{"p1", "p2"},
		Commands: []*bonzai.Cmd{
			&bonzai.Cmd{Name: "foo", Aliases: []string{"f"}},
			&bonzai.Cmd{Name: "bar"},
		},
		Call: func(_ *bonzai.Cmd, _ ...string) error { return nil },
	}
	fmt.Println(internal.InferredUsage(x))
	// Output:
	// ((p1|p2)?|((f|foo)|bar))
}

func ExampleInferredUsage_error_No_Call_or_Command() {
	x := &bonzai.Cmd{
		Params: []string{"p1", "p2"},
	}
	fmt.Println(internal.InferredUsage(x))
	// Output:
	// {ERROR: neither Call nor Commands defined}
}

func ExampleInferredUsage_error_Params_without_Call() {
	x := &bonzai.Cmd{
		Params: []string{"p1", "p2"},
		Commands: []*bonzai.Cmd{
			&bonzai.Cmd{Name: "foo", Aliases: []string{"f"}},
			&bonzai.Cmd{Name: "bar"},
		},
	}
	fmt.Println(internal.InferredUsage(x))
	// Output:
	// {ERROR: Params without Call: p1, p2}
}

func ExampleUsageGroup() {
	fmt.Println(bonzai.UsageGroup([]string{"", "foo", "", "bar", "with space"}, 1, 1))
	fmt.Printf("%q\n", bonzai.UsageGroup([]string{"", ""}, 1, 1))
	fmt.Println(bonzai.UsageGroup([]string{"one"}, 1, 1))
	// Output:
	// (foo|bar|with space)
	// ""
	// one
}
